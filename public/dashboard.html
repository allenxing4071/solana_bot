<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solana MEV 机器人 - 系统监控大屏</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/card-fix.css">
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background-color: #0f1429;
            color: #e0e0e0;
        }
        .dashboard-container {
            padding: 20px;
        }
        .card {
            background-color: #1a2035;
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            margin-bottom: 20px;
            transition: all 0.3s;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.4);
        }
        .card-header {
            background-color: #252d47;
            color: #fff;
            border-bottom: none;
            font-weight: bold;
            padding: 15px 20px;
            border-radius: 10px 10px 0 0;
        }
        .chart-container {
            height: 280px;
            position: relative;
        }
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        .status-good {
            background-color: #2ecc71;
        }
        .status-warning {
            background-color: #f39c12;
        }
        .status-danger {
            background-color: #e74c3c;
        }
        .memory-bar {
            height: 25px;
            background-color: #34495e;
            border-radius: 5px;
            overflow: hidden;
            margin: 10px 0;
        }
        .memory-used {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #f39c12 70%, #e74c3c 100%);
            border-radius: 5px;
            transition: width 0.5s;
        }
        .refresh-btn {
            background-color: #2980b9;
            border: none;
            color: white;
        }
        .refresh-btn:hover {
            background-color: #3498db;
        }
        .stats-value {
            font-size: 28px;
            font-weight: bold;
        }
        .stats-label {
            font-size: 14px;
            color: #bdc3c7;
        }
        .log-container {
            height: 300px;
            overflow-y: auto;
            background-color: #252d47;
            color: #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
        }
        .log-line {
            margin-bottom: 5px;
            border-bottom: 1px solid #34495e;
            padding-bottom: 5px;
        }
        .log-time {
            color: #95a5a6;
            margin-right: 10px;
        }
        .log-info {
            color: #3498db;
        }
        .log-warning {
            color: #f39c12;
        }
        .log-error {
            color: #e74c3c;
        }
        .system-time {
            font-size: 14px;
            color: #95a5a6;
            text-align: right;
            padding: 5px 15px;
        }
        .header-actions {
            float: right;
        }
        table {
            color: #e0e0e0 !important;
        }
        .table-striped>tbody>tr:nth-of-type(odd)>* {
            background-color: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
        }
        .card-value-indicator {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .trend-up {
            color: #2ecc71;
        }
        .trend-down {
            color: #e74c3c;
        }
        .progress {
            height: 8px;
            background-color: #34495e;
        }
        .btn-optimize {
            background-color: #9b59b6;
            border: none;
            color: white;
        }
        .btn-optimize:hover {
            background-color: #8e44ad;
            color: white;
        }
        #performanceChart, #memoryHistoryChart {
            max-height: 250px;
        }
    </style>
</head>
<body>
    <div class="container-fluid dashboard-container">
        <div class="row mb-4">
            <div class="col-12">
                <h1>
                    <i class="fas fa-microchip me-2"></i> Solana MEV 机器人 - 系统监控大屏
                    <div class="float-end">
                        <span id="systemStatus">
                            <span class="status-indicator status-good"></span> 系统运行中
                        </span>
                        <button id="optimizeMemoryBtn" class="btn btn-sm btn-optimize ms-3">
                            <i class="fas fa-broom me-1"></i> 立即优化内存
                        </button>
                        <button id="refreshBtn" class="btn btn-sm refresh-btn ms-2">
                            <i class="fas fa-sync-alt me-1"></i> 刷新数据
                        </button>
                    </div>
                </h1>
                <div class="system-time" id="systemTime">系统时间加载中...</div>
            </div>
        </div>

        <div class="row">
            <!-- 内存概览卡片 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-memory me-2"></i> 内存使用
                    </div>
                    <div class="card-body">
                        <div class="stats-value" id="memoryUsageValue">--.--%</div>
                        <div class="stats-label">系统内存使用率</div>
                        <div class="memory-bar mt-3">
                            <div class="memory-used" id="memoryUsedBar" style="width: 0%"></div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small>0%</small>
                            <small>50%</small>
                            <small>100%</small>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span>总内存:</span>
                                <span id="totalMemory">-- GB</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>已用内存:</span>
                                <span id="usedMemory">-- GB</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>空闲内存:</span>
                                <span id="freeMemory">-- GB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 堆内存卡片 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-layer-group me-2"></i> 堆内存状态
                    </div>
                    <div class="card-body">
                        <div class="stats-value" id="heapUsageValue">--.--%</div>
                        <div class="stats-label">V8 堆内存使用率</div>
                        <div class="memory-bar mt-3">
                            <div class="memory-used" id="heapUsedBar" style="width: 0%"></div>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small>0%</small>
                            <small>50%</small>
                            <small>100%</small>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span>堆大小:</span>
                                <span id="heapSize">-- MB</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>已用堆:</span>
                                <span id="heapUsed">-- MB</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>堆限制:</span>
                                <span id="heapLimit">-- MB</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 内存优化统计 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-line me-2"></i> 优化统计
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="stats-value" id="cleanupCount">0</div>
                                <div class="stats-label">清理次数</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stats-value" id="gcCount">0</div>
                                <div class="stats-label">GC次数</div>
                            </div>
                            <div class="col-6">
                                <div class="stats-value" id="memoryFreed">0</div>
                                <div class="stats-label">释放内存(MB)</div>
                            </div>
                            <div class="col-6">
                                <div class="stats-value" id="leakWarnings">0</div>
                                <div class="stats-label">泄漏警告</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span>最近优化:</span>
                                <span id="lastOptimization">--:--:--</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>内存压力:</span>
                                <span id="memoryPressure">--.--%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 系统状态卡片 -->
            <div class="col-md-3">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-heartbeat me-2"></i> 系统状态
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="stats-value" id="uptime">--:--</div>
                                <div class="stats-label">运行时间</div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stats-value" id="loadAverage">0.00</div>
                                <div class="stats-label">系统负载</div>
                            </div>
                            <div class="col-6">
                                <div class="stats-value" id="cpuUsage">--.--%</div>
                                <div class="stats-label">CPU使用率</div>
                            </div>
                            <div class="col-6">
                                <div class="stats-value" id="poolCount">0</div>
                                <div class="stats-label">监控池数</div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span>状态评估:</span>
                                <span id="systemHealthStatus">良好</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>上次更新:</span>
                                <span id="lastUpdateTime">--:--:--</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- 内存历史趋势图 -->
            <div class="col-md-6">
                <div class="card recent-logs-card" id="systemLogsCard">
                    <div class="card-header">
                        <i class="fas fa-chart-line me-2"></i> 内存使用历史
                        <div class="header-actions">
                            <select id="memoryChartPeriod" class="form-select form-select-sm d-inline-block" style="width: auto;" aria-label="选择内存图表时间范围">
                                <option value="1h">1小时</option>
                                <option value="6h">6小时</option>
                                <option value="24h" selected>24小时</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="memoryHistoryChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 性能指标图 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-tachometer-alt me-2"></i> 性能指标
                        <div class="header-actions">
                            <select id="performanceMetric" class="form-select form-select-sm d-inline-block" style="width: auto;" aria-label="选择性能指标">
                                <option value="heap">堆内存</option>
                                <option value="cpu">CPU使用率</option>
                                <option value="gc">GC频率</option>
                            </select>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="performanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <!-- 系统日志 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-list-alt me-2"></i> 系统日志
                        <div class="header-actions">
                            <button id="clearLogsBtn" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash-alt me-1"></i> 清空
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="log-container" id="logContainer">
                            <div class="log-line">
                                <span class="log-time">载入中...</span>
                                <span class="log-info">系统日志加载中，请稍候...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 内存消耗点列表 -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-database me-2"></i> 内存消耗点
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>名称</th>
                                        <th>优先级</th>
                                        <th>上次清理</th>
                                        <th>释放内存</th>
                                        <th>状态</th>
                                    </tr>
                                </thead>
                                <tbody id="consumersTableBody">
                                    <tr>
                                        <td colspan="5" class="text-center">加载中...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 最近交易卡片，添加id和类名 -->
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card recent-transactions-card" id="recentTransactionsCard">
                    <div class="card-header">
                        <i class="fas fa-exchange-alt me-2"></i> 最近交易
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>交易时间</th>
                                        <th>交易金额</th>
                                        <th>交易类型</th>
                                    </tr>
                                </thead>
                                <tbody id="transactionsTableBody">
                                    <tr>
                                        <td colspan="3" class="text-center">加载中...</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框：优化确认 -->
    <div class="modal fade" id="optimizeModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content bg-dark text-light">
                <div class="modal-header">
                    <h5 class="modal-title">确认内存优化</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>您确定要立即执行内存优化吗？这将会：</p>
                    <ul>
                        <li>清理所有已注册的内存消耗点</li>
                        <li>释放未使用的缓存内存</li>
                        <li>强制执行一次垃圾回收</li>
                    </ul>
                    <p>在高负载情况下，优化过程可能会导致短暂的系统响应延迟。</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="button" class="btn btn-optimize" id="confirmOptimizeBtn">确认优化</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript依赖 -->
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.2.3/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html> 