<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solana MEV机器人 - 仪表盘</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.min.css">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- 侧边栏 -->
  <div class="sidebar">
    <div class="logo">
      <img src="img/logo.svg" alt="Solana Logo">
      <div class="logo-text">Solana MEV机器人</div>
    </div>
    
    <nav class="menu">
      <a href="index.html" class="menu-item active">
        <i class="ri-dashboard-line"></i>
        仪表盘
      </a>
      <a href="memory.html" class="menu-item">
        <i class="ri-cpu-line"></i>
        内存监控
      </a>
      <a href="pools.html" class="menu-item">
        <i class="ri-water-flash-line"></i>
        流动性池
      </a>
      <a href="tokens.html" class="menu-item">
        <i class="ri-coin-line"></i>
        代币监控
      </a>
      <a href="trades.html" class="menu-item">
        <i class="ri-exchange-box-line"></i>
        交易记录
      </a>
      <a href="settings.html" class="menu-item">
        <i class="ri-settings-line"></i>
        设置
      </a>
    </nav>
    
    <div class="system-status">
      <div class="system-status-indicator">
        <div class="status-dot running"></div>
        <div class="status-text text-success">运行中</div>
      </div>
      <div class="text-secondary text-sm">运行时间: <span class="uptime">3小时15分钟</span></div>
      <div class="control-buttons">
        <button class="btn btn-error btn-sm" id="stopBtn" title="停止系统">
          <i class="ri-stop-circle-line"></i> 停止
        </button>
        <button class="btn btn-primary btn-sm" id="startBtn" title="启动系统">
          <i class="ri-play-circle-line"></i> 启动
        </button>
      </div>
    </div>
  </div>

  <!-- 主内容区 -->
  <div class="main-content">
    <div class="top-bar">
      <button class="menu-toggle" id="menuToggle" title="打开菜单">
        <i class="ri-menu-line"></i>
      </button>
      <h1 class="page-title">仪表盘概览</h1>
      <div class="top-bar-right flex items-center gap-4">
        <div class="text-secondary text-sm last-updated">最后更新: 2023-11-26 15:32:45</div>
        <button class="btn btn-outline btn-icon" id="themeToggleBtn" title="切换主题">
          <i class="ri-moon-line"></i>
        </button>
        <button class="btn btn-outline btn-icon" id="refreshBtn" title="刷新数据">
          <i class="ri-refresh-line"></i>
        </button>
      </div>
    </div>
    
    <div class="content-area">
      <!-- 筛选和搜索工具栏 -->
      <div class="toolbar">
        <div class="search-wrapper">
          <i class="ri-search-line"></i>
          <input type="text" id="searchInput" placeholder="搜索..." class="search-input">
        </div>
        <!-- 其他工具栏内容 -->
      </div>
      
      <!-- 修改统计卡片区域，确保铺满整行 -->
      <div class="stats-grid index-stats-grid">
        <div class="stat-card">
          <div class="stat-title">CPU使用率</div>
          <div class="stat-value"><span class="cpu-usage">32.5%</span></div>
          <div class="progress-bar">
            <div class="progress-fill cpu" style="width: 32.5%"></div>
          </div>
          <div class="stat-indicator">8核心</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">内存使用率</div>
          <div class="stat-value"><span class="memory-usage">39.1%</span></div>
          <div class="progress-bar">
            <div class="progress-fill memory" style="width: 39.1%"></div>
          </div>
          <div class="stat-indicator">8192 MB</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">总收益</div>
          <div class="stat-value">$142.57</div>
          <div class="stat-indicator positive">
            <i class="ri-arrow-up-line"></i> 今日: $12.34
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">监控代币数</div>
          <div class="stat-value">128</div>
          <div class="stat-indicator positive">
            <i class="ri-arrow-up-line"></i> 今日新增: 23
          </div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">活跃池数</div>
          <div class="stat-value">87</div>
          <div class="stat-indicator">共监控 143 个池</div>
        </div>
        
        <div class="stat-card">
          <div class="stat-title">执行交易数</div>
          <div class="stat-value">156</div>
          <div class="stat-indicator positive">
            <i class="ri-arrow-up-line"></i> 成功率: 91.7%
          </div>
        </div>
      </div>
      
      <!-- 图表部分修改：将两个图表并排放置 -->
      <div class="flex gap-4" style="flex-wrap: wrap;">
        <div class="card" style="flex: 1; min-width: 300px;">
          <div class="card-header">
            <div class="card-title">代币发现趋势 (12小时)</div>
            <div class="flex gap-2">
              <button class="btn btn-outline btn-sm active" title="显示12小时数据">12小时</button>
              <button class="btn btn-outline btn-sm" title="显示24小时数据">24小时</button>
              <button class="btn btn-outline btn-sm" title="显示7天数据">7天</button>
            </div>
          </div>
          <div class="chart-container" id="tokenDiscoveryChart"></div>
        </div>
        
        <div class="card" style="flex: 1; min-width: 300px;">
          <div class="card-header">
            <div class="card-title">利润趋势 (7天)</div>
            <div class="flex gap-2">
              <button class="btn btn-outline btn-sm" title="显示24小时数据">24小时</button>
              <button class="btn btn-outline btn-sm active" title="显示7天数据">7天</button>
              <button class="btn btn-outline btn-sm" title="显示30天数据">30天</button>
            </div>
          </div>
          <div class="chart-container" id="profitTrendChart"></div>
        </div>
      </div>
      
      <!-- 最近交易区域 -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">最近交易</div>
          <a href="trades.html" class="btn btn-outline btn-sm" title="查看全部交易记录">
            查看全部 <i class="ri-arrow-right-line"></i>
          </a>
        </div>
        <div class="table-container">
          <table id="recentTradesTable">
            <thead>
              <tr>
                <th>交易ID</th>
                <th>代币对</th>
                <th>数量</th>
                <th>收益</th>
                <th>时间</th>
                <th>状态</th>
              </tr>
            </thead>
            <tbody id="tradesTableBody">
              <!-- 交易数据会通过JavaScript动态加载 -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- 最近发现的代币区域 -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">最近发现的代币</div>
          <a href="tokens.html" class="btn btn-outline btn-sm" title="查看全部代币">
            查看全部 <i class="ri-arrow-right-line"></i>
          </a>
        </div>
        <div class="table-container">
          <table id="recentTokensTable">
            <thead>
              <tr>
                <th>代币名称</th>
                <th>地址</th>
                <th>发现时间</th>
                <th>流动性</th>
                <th>风险等级</th>
              </tr>
            </thead>
            <tbody id="tokensTableBody">
              <!-- 代币数据会通过JavaScript动态加载 -->
            </tbody>
          </table>
        </div>
      </div>
      
      <!-- 系统日志区域 -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">系统日志</div>
          <button class="btn btn-outline btn-sm" id="clearLogsBtn" title="清除所有日志">
            <i class="ri-delete-bin-line"></i> 清除日志
          </button>
        </div>
        <div class="log-container" id="logContainer">
          <!-- 日志内容会通过JavaScript动态加载 -->
        </div>
      </div>
    </div>
  </div>

  <script src="js/utils.js"></script>
  <script>
    // 当文档加载完成时执行
    document.addEventListener('DOMContentLoaded', async function() {
      // 加载系统日志
      async function loadLogs() {
        const data = await fetchData('logs_data.json');
        if (!data || !data.success) return;
        
        const logContainer = document.getElementById('logContainer');
        if (!logContainer) return;
        
        logContainer.innerHTML = '';
        
        for (const log of data.data.logs) {
          const logEntry = document.createElement('div');
          logEntry.className = 'log-entry';
          
          const levelClass = log.level === 'INFO' 
            ? 'text-info' 
            : log.level === 'WARNING' 
              ? 'text-warning' 
              : 'text-error';
          
          logEntry.innerHTML = `
            <span class="log-time">${formatDateTime(log.timestamp)}</span>
            <span class="log-level ${levelClass}">[${log.level}]</span>
            <span class="log-module">[${log.module}]</span>
            <span class="log-message">${log.message}</span>
          `;
          
          logContainer.appendChild(logEntry);
        }
      }
      
      // 加载最近交易
      async function loadRecentTrades() {
        const data = await fetchData('recent_trades.json');
        if (!data || !data.success) return;
        
        const trades = data.data.trades;
        const tableBody = document.getElementById('tradesTableBody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        for (const trade of trades) {
          const row = document.createElement('tr');
          
          const statusClass = trade.status === '成功' 
            ? 'badge-success' 
            : 'badge-error';
          
          row.innerHTML = `
            <td>${trade.id}</td>
            <td>${trade.tokenPair}</td>
            <td>${formatNumber(trade.amount)}</td>
            <td class="text-success">$${trade.profit.toFixed(2)}</td>
            <td>${formatDateTime(trade.timestamp)}</td>
            <td><span class="badge ${statusClass}">${trade.status}</span></td>
          `;
          
          tableBody.appendChild(row);
        }
      }
      
      // 加载最近发现的代币
      async function loadRecentTokens() {
        const data = await fetchData('tokens_discovered.json');
        if (!data || !data.success) return;
        
        const tokens = data.data.tokens;
        const tableBody = document.getElementById('tokensTableBody');
        if (!tableBody) return;
        
        tableBody.innerHTML = '';
        
        for (const token of tokens) {
          const row = document.createElement('tr');
          
          let riskClass = 'badge-success';
          let riskText = '低风险';
          
          if (token.riskScore > 7) {
            riskClass = 'badge-error';
            riskText = '高风险';
          } else if (token.riskScore > 3) {
            riskClass = 'badge-warning';
            riskText = '中风险';
          }
          
          row.innerHTML = `
            <td>${token.name}</td>
            <td>${formatAddress(token.address)}</td>
            <td>${formatDateTime(token.discoveredAt)}</td>
            <td>$${formatNumber(token.liquidity)}</td>
            <td><span class="badge ${riskClass}">${riskText} (${token.riskScore.toFixed(1)})</span></td>
          `;
          
          tableBody.appendChild(row);
        }
      }
      
      // 初始化图表
      function initCharts() {
        // 因为这是静态页面，使用模拟的图表数据
        const tokenDiscoveryCtx = document.getElementById('tokenDiscoveryChart');
        if (tokenDiscoveryCtx) {
          new Chart(tokenDiscoveryCtx, {
            type: 'bar',
            data: {
              labels: ['0时', '1时', '2时', '3时', '4时', '5时', '6时', '7时', '8时', '9时', '10时', '11时'],
              datasets: [{
                label: '发现的代币数',
                data: [2, 1, 0, 1, 0, 0, 2, 3, 4, 5, 3, 2],
                backgroundColor: '#9945FF',
                borderColor: '#9945FF',
                borderWidth: 1,
                borderRadius: 4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                  },
                  ticks: {
                    color: '#A0AEC0'
                  }
                },
                x: {
                  grid: {
                    display: false
                  },
                  ticks: {
                    color: '#A0AEC0'
                  }
                }
              }
            }
          });
        }
        
        const profitTrendCtx = document.getElementById('profitTrendChart');
        if (profitTrendCtx) {
          new Chart(profitTrendCtx, {
            type: 'line',
            data: {
              labels: ['11-20', '11-21', '11-22', '11-23', '11-24', '11-25', '11-26'],
              datasets: [{
                label: '日收益 ($)',
                data: [10.23, 12.56, 9.87, 15.42, 14.78, 15.91, 12.34],
                backgroundColor: 'rgba(20, 241, 149, 0.2)',
                borderColor: '#14F195',
                tension: 0.4,
                fill: true
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  grid: {
                    color: 'rgba(255, 255, 255, 0.1)'
                  },
                  ticks: {
                    color: '#A0AEC0',
                    callback: function(value) {
                      return '$' + value;
                    }
                  }
                },
                x: {
                  grid: {
                    display: false
                  },
                  ticks: {
                    color: '#A0AEC0'
                  }
                }
              }
            }
          });
        }
      }
      
      // 初始化事件监听
      function initEventListeners() {
        // 清除日志按钮
        const clearLogsBtn = document.getElementById('clearLogsBtn');
        if (clearLogsBtn) {
          clearLogsBtn.addEventListener('click', function() {
            const logContainer = document.getElementById('logContainer');
            if (logContainer) {
              logContainer.innerHTML = '';
            }
            showNotification('成功', '日志已清除', 'success');
          });
        }
        
        // 启动按钮
        const startBtn = document.getElementById('startBtn');
        if (startBtn) {
          startBtn.addEventListener('click', function() {
            showNotification('成功', 'MEV机器人已启动', 'success');
            
            // 更新状态指示器
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            
            if (statusDot && statusText) {
              statusDot.className = 'status-dot running';
              statusText.textContent = '运行中';
              statusText.className = 'status-text text-success';
            }
          });
        }
        
        // 停止按钮
        const stopBtn = document.getElementById('stopBtn');
        if (stopBtn) {
          stopBtn.addEventListener('click', function() {
            showNotification('提示', 'MEV机器人已停止', 'warning');
            
            // 更新状态指示器
            const statusDot = document.querySelector('.status-dot');
            const statusText = document.querySelector('.status-text');
            
            if (statusDot && statusText) {
              statusDot.className = 'status-dot stopped';
              statusText.textContent = '已停止';
              statusText.className = 'status-text text-error';
            }
          });
        }
      }
      
      // 加载数据
      await Promise.all([
        loadLogs(),
        loadRecentTrades(),
        loadRecentTokens()
      ]);
      
      // 初始化图表和事件监听
      initCharts();
      initEventListeners();
    });
  </script>
</body>
</html> 